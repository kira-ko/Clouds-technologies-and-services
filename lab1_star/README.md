# Лабораторная работа №1 со звездочкой. Взлом nginx сайта

В данной лабораторной предлагается попробовать вломать любой из доступных сайтов на наш выбор

За основу мы решили взять сайт школы: https://лицей6.рф/образование
 (тем более на главной странице можно заметить, что сайт старый и они как раз "переезжают" на новый, так что welcome путь для наших эксперементов открыт. ну и ~взломать~ проверить сайт школы на уязвимости всегда интересно)

## Path traversal (обход пути) 
Это первая уязвимость на которую мы решили проверить сайт. Ее суть в том, что она позволяет злоумышленнику получить доступ к файлам и директориям на сервере, находящимся за пределами разрешенной области 

### 1 шаг: установка curl
```
sudo apt install curl
```

### 2 шаг: проверяем насколько нам вообще интересен данный сайт для проверки:
```
curl -I https://лицей6.рф/образование
```

<img width="1189" height="322" alt="Screenshot from 2025-12-11 21-38-11" src="https://github.com/user-attachments/assets/b21cc146-d957-4974-b8a2-cb0d13f497f4" />

Видим что никаких ошибок на уровне 404/403/500 нет. Сайт действительно работает на nginx, что для лабы нам и нужно. Но также видим что сайт выставил на показ свою версию nginx, из-за чего злоумышленники могут понять, на какой версии им запускать атаки. Для сайта не очень хороший момент, но нам то, что надо


### 3 шаг: теперь уже реально проверяем Path Traversal

<img width="1189" height="230" alt="unnamed" src="https://github.com/user-attachments/assets/312f9bc1-3f94-4bb8-91c5-8d8c47392e2d" />

При запросе к корневому URL с добавлением ../ происходит нормализация пути и загрузка главной страницы (200 OK). Это стандартное и безопасное поведение.

<img width="1189" height="228" alt="unnamed (2)" src="https://github.com/user-attachments/assets/dd50117a-ce5b-4213-8a26-c57a2d34dcdf" />

Сервер корректно нормализует путь с использованием ../ в директории wp-content. Запрос приводит к перенаправлению (301 Redirect) на корректный базовый URL

<img width="1189" height="260" alt="Screenshot from 2025-12-11 21-53-51" src="https://github.com/user-attachments/assets/f87c467e-8c15-43da-bd1a-c87bc1397873" />

Сервер корректно обрабатывает URL-кодированную форму последовательности ../. Попытка Path Traversal приводит к ответу 404 Not Found

<img width="1189" height="474" alt="Screenshot from 2025-12-11 22-06-54" src="https://github.com/user-attachments/assets/cbbbc93f-91ca-4050-8a30-25cd40d9bd2c" />
<img width="1189" height="282" alt="Screenshot from 2025-12-11 22-22-14" src="https://github.com/user-attachments/assets/99a92258-42ee-4699-85c7-b2d0008f8675" />
<img width="1189" height="228" alt="unnamed (6)" src="https://github.com/user-attachments/assets/51030f92-5296-486b-8ad6-10566b194b9e" />



Видим, что ни одна из попыток не дала доступа к родительским директориям, а значит сервер защищен корректно


## FFUF
Переходим к FUFF - быстрый инструмент для перебора URL-путей

### 1 шаг: уcтановка
```
sudo apt install ffuf
```

### 2 шаг: ffuf умеет работать с Unicode, но Punycode надёжнее, поэтому кодируем домен
```
https://xn--6-itbifh1e.xn--p1ai
```

### 3 шаг: запускаем перебор директорий:
```
ffuf -u https://xn--6-itbifh1e.xn--p1ai/FUZZ \
     -w /snap/seclists/current/Discovery/Web-Content/common.txt \
     -mc 200,301,302
```
<img width="1161" height="647" alt="unnamed (11)" src="https://github.com/user-attachments/assets/aa7b53ae-e6c8-435f-9d07-ad0b08d73507" />
<img width="1161" height="719" alt="unnamed (10)" src="https://github.com/user-attachments/assets/88a8ae3f-6da0-400c-860c-32cd7b294f8b" />
<img width="1161" height="719" alt="unnamed (9)" src="https://github.com/user-attachments/assets/2b2fd8fb-ebbe-4974-bc1c-f9f32b36397b" />
<img width="1161" height="719" alt="unnamed (8)" src="https://github.com/user-attachments/assets/c1d1a1d2-d01c-48dc-841a-6bb704fea773" />

Обнаружены несколько валидных страниц с кодом 200 OK и крупным размером ответа (≈270–300 КБ): 2018, 2019, 2020, 2021, 2022, page1, food и др. По размерам и поведению это обычные контентные страницы/архивы WordPress и они не представляют интереса с точки зрения уязвимостей. Также обнаружен набор стандартных системных путей: wp-admin, wp-content, wp-includes — код 301 с перенаправлением, что соответствует типичному поведению WordPress; и фиды, служебные файлы и стандартаная страница авторизации (feed, rss, robots.txt, sitemap.xml, favicon.ico, login, dashboard)

Особенно привлекает внимание (но не для взлома) группа путей, начинающихся с admin (/admin, /adminpanel, /adminlogin, /administrator, и др.). Все эти запросы возвращают код 200 OK, но содержат одинаковый очень небольшой ответ: размер около 130–150 байт. Можем предположить, что такое поведение характерно для страницы заглушки (404), либо механизма защиты, сознательно возвращающего единообразный ответ для произвольных «админских» URL. В результате перебора невозможно определить, какие из этих путей действительно существуют, а какие нет, что снижает эффективность атак и в целом очень хороший признак с точки зрения безопасности

Поэтому перебор путей с помощью ffuf уязвимостей не подсвятил

## Проверка конфигурации index + autoindex
Простая и быстрая, но очень показательная проверка: при неправильной конфигурации nginx можно случайно открыть пользователям список файлов на сервере 

вот так выглядит опасная конфигурация: autoindex on;

проверка на нашем сайте:
```
curl -I https://xn--6-itbifh1e.xn--p1ai/wp-content/
curl -I https://xn--6-itbifh1e.xn--p1ai/wp-content/uploads/
curl -I https://xn--6-itbifh1e.xn--p1ai/wp-includes/
```

<img width="966" height="148" alt="unnamed (4)" src="https://github.com/user-attachments/assets/17c7b4e7-4198-4fe2-a55a-0d3159145a00" />
<img width="966" height="148" alt="unnamed (5)" src="https://github.com/user-attachments/assets/238935f9-6d9c-4f24-aec0-7d682070fae8" />


Здесь все идеально. Пользователю нельзя смотреть содержимое директории -- мы его и не видим (403)

<img width="966" height="189" alt="unnamed (3)" src="https://github.com/user-attachments/assets/ebffc87f-5cc3-4572-9b4d-57773ce4c4b4" />

На первый взгляд может показаться интересным моментом, но нет. Так как /wp-content/ сама по себе не должна отдавать список файлов, но она может отдавать index.php, который показывает обычную страницу сайта. А мы видим, что в ответе нет листинга, значит сайт ничего нам не выдает

## Вывод
В результате лабораторной работе к сожалению или к счастью нам не удалось найти уязвимости в настройке сервера nginx. Можем сделать вывод что гос сайты все же не так легки для взлома, ну или не подаются лапкам второкурсников
